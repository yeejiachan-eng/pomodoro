<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ³¨ç•ªèŒ„é˜</title>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM (ç§»é™¤ crossorigin ä»¥é¿å…æ½›åœ¨çš„ CORS å•é¡Œ) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- å¼•å…¥ Lucide React åœ–ç¤ºåº« (é–å®šç©©å®šç‰ˆæœ¬ 0.263.1 ä»¥ä¿®å¾© forwardRef éŒ¯èª¤) -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.min.js"></script>

    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(200, 200, 200, 0.5);
            border-radius: 20px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // å¾å…¨åŸŸè®Šæ•¸ä¸­å–å¾— React Hooks å’Œ Lucide åœ–ç¤º
        const { useState, useEffect, useRef } = React;
        
        // ç¢ºä¿ lucideReact å·²è¼‰å…¥ï¼Œå¦å‰‡æä¾›éŒ¯èª¤æç¤º
        const lucideIcons = window.lucideReact || {};
        const { Play, Pause, RotateCcw, Plus, Trash2, CheckCircle, Coffee, Brain, Armchair } = lucideIcons;

        const App = () => {
            // -------------------------------------------------------------------------
            // ç‹€æ…‹å®šç¾©
            // -------------------------------------------------------------------------
            const [mode, setMode] = useState('focus'); // focus, shortBreak, longBreak
            const [timeLeft, setTimeLeft] = useState(25 * 60);
            const [isActive, setIsActive] = useState(false);
            const [tasks, setTasks] = useState([]);
            const [newTaskInput, setNewTaskInput] = useState('');
            
            // ç”¨æ–¼éŸ³æ•ˆ
            const audioContextRef = useRef(null);

            // -------------------------------------------------------------------------
            // è¨­å®šåƒæ•¸
            // -------------------------------------------------------------------------
            const MODES = {
                focus: {
                id: 'focus',
                label: 'å°ˆæ³¨æ™‚é–“',
                time: 25 * 60,
                color: 'bg-rose-500',
                textColor: 'text-rose-500',
                lightColor: 'bg-rose-100',
                icon: Brain ? <Brain size={20} /> : <span>ğŸ§ </span>
                },
                shortBreak: {
                id: 'shortBreak',
                label: 'çŸ­æš«ä¼‘æ¯',
                time: 5 * 60,
                color: 'bg-teal-500',
                textColor: 'text-teal-500',
                lightColor: 'bg-teal-100',
                icon: Coffee ? <Coffee size={20} /> : <span>â˜•</span>
                },
                longBreak: {
                id: 'longBreak',
                label: 'é•·ä¼‘æ¯',
                time: 15 * 60,
                color: 'bg-indigo-500',
                textColor: 'text-indigo-500',
                lightColor: 'bg-indigo-100',
                icon: Armchair ? <Armchair size={20} /> : <span>ğŸ›‹ï¸</span>
                }
            };

            // -------------------------------------------------------------------------
            // é‚è¼¯è™•ç†
            // -------------------------------------------------------------------------
            
            // æ’­æ”¾æç¤ºéŸ³
            const playAlarm = () => {
                if (!audioContextRef.current) {
                audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const ctx = audioContextRef.current;
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, ctx.currentTime); 
                oscillator.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.5); 
                
                gainNode.gain.setValueAtTime(0.5, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);

                oscillator.start();
                oscillator.stop(ctx.currentTime + 0.5);
            };

            // è¨ˆæ™‚å™¨é‚è¼¯
            useEffect(() => {
                let interval = null;

                document.title = `${formatTime(timeLeft)} - ${MODES[mode].label}`;

                if (isActive && timeLeft > 0) {
                interval = setInterval(() => {
                    setTimeLeft((prevTime) => prevTime - 1);
                }, 1000);
                } else if (timeLeft === 0 && isActive) {
                setIsActive(false);
                playAlarm();
                clearInterval(interval);
                } else {
                clearInterval(interval);
                }

                return () => clearInterval(interval);
            }, [isActive, timeLeft, mode]);

            // åˆ‡æ›æ¨¡å¼
            const switchMode = (newMode) => {
                setMode(newMode);
                setTimeLeft(MODES[newMode].time);
                setIsActive(false);
            };

            // åˆ‡æ›é–‹å§‹/æš«åœ
            const toggleTimer = () => {
                setIsActive(!isActive);
                if (!audioContextRef.current) {
                audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                }
            };

            // é‡ç½®
            const resetTimer = () => {
                setIsActive(false);
                setTimeLeft(MODES[mode].time);
            };

            // æ ¼å¼åŒ–æ™‚é–“ mm:ss
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            const progress = ((MODES[mode].time - timeLeft) / MODES[mode].time) * 100;

            // ä»»å‹™ç®¡ç†
            const addTask = (e) => {
                e.preventDefault();
                if (!newTaskInput.trim()) return;
                setTasks([...tasks, { id: Date.now(), text: newTaskInput, completed: false }]);
                setNewTaskInput('');
            };

            const toggleTask = (id) => {
                setTasks(tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
            };

            const deleteTask = (id) => {
                setTasks(tasks.filter(t => t.id !== id));
            };

            // -------------------------------------------------------------------------
            // æ¸²æŸ“ UI
            // -------------------------------------------------------------------------
            const currentTheme = MODES[mode];

            return (
                <div className={`min-h-screen transition-colors duration-500 ease-in-out ${currentTheme.color} flex items-center justify-center p-4 font-sans`}>
                <div className="w-full max-w-md bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl overflow-hidden flex flex-col transition-all duration-300">
                    
                    {/* é ‚éƒ¨å°èˆª */}
                    <div className="flex p-2 bg-gray-100/50 justify-between items-center">
                    {Object.values(MODES).map((m) => (
                        <button
                        key={m.id}
                        onClick={() => switchMode(m.id)}
                        className={`flex-1 flex items-center justify-center gap-2 py-3 px-2 rounded-2xl text-sm font-bold transition-all duration-300 
                            ${mode === m.id ? 'bg-white shadow-sm text-gray-800 scale-100' : 'text-gray-400 hover:text-gray-600 hover:bg-white/50 scale-95'}`}
                        >
                        {m.icon}
                        <span className="hidden sm:inline">{m.label}</span>
                        </button>
                    ))}
                    </div>

                    {/* ä¸»è¦è¨ˆæ™‚å™¨ */}
                    <div className="flex flex-col items-center justify-center py-10 px-6 relative">
                    <div className="relative z-10">
                        <div className={`text-8xl font-black tracking-tighter tabular-nums transition-colors duration-300 ${currentTheme.textColor}`}>
                        {formatTime(timeLeft)}
                        </div>
                        <div className={`text-center mt-2 font-medium text-lg text-gray-400 tracking-widest uppercase`}>
                        {isActive ? 'é€²è¡Œä¸­' : 'å·²æš«åœ'}
                        </div>
                    </div>
                    
                    <div className="absolute bottom-0 left-0 h-1 bg-gray-100 w-full">
                        <div 
                        className={`h-full transition-all duration-1000 ease-linear ${currentTheme.color}`} 
                        style={{ width: `${100 - progress}%` }}
                        />
                    </div>
                    </div>

                    {/* æŒ‰éˆ• */}
                    <div className="flex items-center justify-center gap-6 pb-10">
                    <button 
                        onClick={toggleTimer}
                        className={`h-20 w-20 rounded-full flex items-center justify-center shadow-lg transform active:scale-95 transition-all duration-200 
                        ${isActive ? 'bg-white text-gray-700 ring-2 ring-gray-200' : `${currentTheme.color} text-white hover:brightness-110`}`}
                    >
                        {isActive ? (Pause ? <Pause size={32} fill="currentColor" /> : "||") : (Play ? <Play size={32} fill="currentColor" className="ml-1" /> : "â–¶")}
                    </button>

                    <button 
                        onClick={resetTimer}
                        className="h-14 w-14 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center hover:bg-gray-200 hover:text-gray-700 transition-colors"
                    >
                        {RotateCcw ? <RotateCcw size={24} /> : "R"}
                    </button>
                    </div>

                    {/* ä»»å‹™ */}
                    <div className="bg-gray-50 flex-1 p-6 border-t border-gray-100">
                    <h3 className="text-gray-500 font-bold mb-4 flex items-center gap-2">
                        <span className={`w-1 h-5 rounded-full ${currentTheme.color}`}></span>
                        å¾…è¾¦äº‹é …
                    </h3>
                    
                    <form onSubmit={addTask} className="relative mb-4 group">
                        <input
                        type="text"
                        value={newTaskInput}
                        onChange={(e) => setNewTaskInput(e.target.value)}
                        placeholder="æ–°å¢ä¸€å€‹å°ˆæ³¨ä»»å‹™..."
                        className="w-full bg-white border-none rounded-xl py-4 pl-4 pr-12 shadow-sm text-gray-700 placeholder-gray-400 focus:ring-2 focus:ring-opacity-50 transition-all outline-none focus:ring-gray-300"
                        style={{ '--tw-ring-color': currentTheme.color }} 
                        />
                        <button 
                        type="submit"
                        className={`absolute right-2 top-2 p-2 rounded-lg text-white transition-transform duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed ${currentTheme.color}`}
                        disabled={!newTaskInput.trim()}
                        >
                        {Plus ? <Plus size={20} /> : "+"}
                        </button>
                    </form>

                    <div className="space-y-2 max-h-48 overflow-y-auto pr-1 custom-scrollbar">
                        {tasks.length === 0 && (
                        <div className="text-center py-4 text-gray-400 text-sm">
                            ç›®å‰æ²’æœ‰ä»»å‹™ï¼Œæ–°å¢ä¸€é …ä¾†é–‹å§‹å°ˆæ³¨å§ï¼
                        </div>
                        )}
                        
                        {tasks.map((task) => (
                        <div 
                            key={task.id} 
                            className={`group flex items-center justify-between p-3 rounded-xl bg-white border border-gray-100 shadow-sm transition-all duration-200 ${task.completed ? 'opacity-60 bg-gray-50' : 'hover:border-gray-300'}`}
                        >
                            <div className="flex items-center gap-3 overflow-hidden">
                            <button 
                                onClick={() => toggleTask(task.id)}
                                className={`flex-shrink-0 transition-colors duration-200 ${task.completed ? currentTheme.textColor : 'text-gray-300 hover:text-gray-400'}`}
                            >
                                {CheckCircle ? <CheckCircle size={22} className={task.completed ? "fill-current" : ""} /> : (task.completed ? "â˜‘" : "â˜")}
                            </button>
                            <span className={`truncate text-gray-700 ${task.completed ? 'line-through text-gray-400' : ''}`}>
                                {task.text}
                            </span>
                            </div>
                            
                            <button 
                            onClick={() => deleteTask(task.id)}
                            className="text-gray-300 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100 p-1"
                            >
                            {Trash2 ? <Trash2 size={18} /> : "x"}
                            </button>
                        </div>
                        ))}
                    </div>
                    </div>
                </div>
                
                <div className="fixed bottom-4 text-white/60 text-xs text-center w-full pointer-events-none">
                    å°ˆæ³¨ãƒ»å‘¼å¸ãƒ»æ”¾é¬†
                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
